{% for venta in ventas %}
<tr hx-get="/delivery/detalle_pedido/{{ venta.id }}" 
    hx-target="#right_panel" 
    hx-swap="innerHTML" 
    style="cursor:pointer">
    <td>{{ venta.id }}</td>
    <td>{{ venta.fecha_hora.strftime('%H:%M') if venta.fecha_hora }}</td>
    <td>{% if venta.cliente and venta.cliente.persona %}
            {{ venta.cliente.persona.direccion or venta.cliente.persona.direccion }}
        {% else %}
            Sin Dirección
        {% endif %}
    </td>
    <td>{% if venta.cliente and venta.cliente.persona %}
            {{ venta.cliente.persona.telefono or venta.cliente.persona.telefono }}
        {% else %}
            Sin teléfono
        {% endif %}
    </td>
    <td>
        {% if venta.cliente and venta.cliente.persona %}
            {{ venta.cliente.persona.razon_social or venta.cliente.persona.razon_social }}
        {% else %}
            Sin cliente
        {% endif %}
    </td>
    <td>{{ venta.repartidor.persona.razon_social if venta.repartidor else 'Sin repartidor' }}</td>
    <td>{{ venta.fecha_hora|timeago }}</td> <!-- Nueva columna con tiempo transcurrido -->
    <td>${{ venta.total|format_price }}</td>
    <td>
        {% if venta.estado_delivery == 1 %}
            <button class="btn btn-sm btn-warning"
                    hx-post="/delivery/cambiar_estado/{{ venta.id }}/2"
                    hx-trigger="click"
                    onclick="event.stopPropagation()">
                Enviar
            </button>
        {% elif venta.estado_delivery == 2 %}
            <button class="btn btn-sm btn-success"
                    hx-post="/delivery/cambiar_estado/{{ venta.id }}/3"
                    hx-trigger="click"
                    onclick="event.stopPropagation()">
                Entregar
            </button>
        {% elif venta.estado_delivery == 3 %}
            <span class="badge bg-success">Entregado</span>
        {% else %}
            <span class="badge bg-secondary">{{ venta.estado_delivery }}</span>
        {% endif %}
    </td>
</tr>
{% endfor %}